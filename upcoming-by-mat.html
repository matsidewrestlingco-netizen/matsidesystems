<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Matside — Upcoming Matches by Mat (v3)</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

<style>
/* ------------------ GLOBAL THEME ------------------ */

body {
  margin: 0;
  padding: 20px;
  background: #0a0a0a;
  font-family: "Inter", sans-serif;
  color: #e6e6e6;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
  text-shadow: 0 0 12px rgba(255,255,255,0.35);
}

/* ------------------ MAT GRID ------------------ */

.mat-container {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 18px;
  margin-top: 20px;
  max-width: 1400px;
  margin-left: auto;
  margin-right: auto;
}

.mat-column {
  background: #1a1a1a;
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 0 25px rgba(255,255,255,0.03);
}

/* Header */
.mat-title {
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  padding-bottom: 10px;
  margin-bottom: 15px;
  border-bottom: 1px solid #333;
  text-shadow: 0 0 12px rgba(255,255,255,0.45);
}

/* ------------------ MATCH BLOCKS ------------------ */

.match-block {
  padding: 12px;
  border-radius: 10px;
  background: #222;
  margin-bottom: 10px;
  border: 1px solid #333;
}

.match-block.now {
  border-color: #ff4444;
  background: rgba(255, 68, 68, 0.15);
  box-shadow: 0 0 12px rgba(255, 68, 68, 0.35);
}

.match-block.deck {
  border-color: #3a77ff;
  background: rgba(58, 119, 255, 0.15);
  box-shadow: 0 0 12px rgba(58, 119, 255, 0.35);
}

.match-block.hole {
  border-color: #ffaa33;
  background: rgba(255, 170, 51, 0.15);
  box-shadow: 0 0 12px rgba(255, 170, 51, 0.35);
}

.match-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 4px;
}

.match-line {
  font-size: 15px;
  margin-bottom: 2px;
  opacity: 0.9;
}

.divider {
  margin: 10px 0;
  height: 1px;
  background: rgba(255,255,255,0.08);
}

/* Group labels: Now / On Deck / In The Hole / Queue */

.group-title {
  font-size: 16px;
  margin-bottom: 8px;
  opacity: 0.8;
  font-weight: 600;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

</style>
</head>

<body>

<h1>Upcoming Matches by Mat</h1>

<div class="mat-container">
  <div id="mat-1" class="mat-column"></div>
  <div id="mat-2" class="mat-column"></div>
  <div id="mat-3" class="mat-column"></div>
  <div id="mat-4" class="mat-column"></div>
</div>

<script>
/* ------------------ FIREBASE INIT ------------------ */

const firebaseConfig = {
  apiKey: "AIzaSyD_uk47fURmQiHZnN8avfcGoNObMntdu_s",
  authDomain: "matsidewrestlingco-fb85f.firebaseapp.com",
  projectId: "matsidewrestlingco-fb85f",
  storageBucket: "matsidewrestlingco-fb85f.firebasestorage.app",
  messagingSenderId: "898197416726",
  appId: "1:898197416726:web:921ccbd0f63f7fd6537e37"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ------------------ LIVE LISTENER ------------------ */

db.collection("matchLibrary").onSnapshot(snapshot => {
  const all = snapshot.docs
    .map(d => ({ id: d.id, ...d.data() }))
    .filter(m => !m.completed); // hide completed matches

  // Group by mat
  const mats = { 1: [], 2: [], 3: [], 4: [] };

  all.forEach(m => {
    if (m.assignedMat >= 1 && m.assignedMat <= 4) {
      mats[m.assignedMat].push(m);
    }
  });

  // SORT BY BOUT NUMBER (your chosen system)
  for (let m = 1; m <= 4; m++) {
    mats[m].sort((a, b) => Number(a.bout) - Number(b.bout));
  }

  // Render each mat
  for (let m = 1; m <= 4; m++) {
    renderMat(m, mats[m]);
  }
});

/* ------------------ RENDER A MAT COLUMN ------------------ */

function renderMat(matNum, list) {
  const el = document.getElementById("mat-" + matNum);
  el.innerHTML = `
    <div class="mat-title">Mat ${matNum}</div>
  `;

  if (!list.length) {
    el.innerHTML += `<div style="opacity:0.5;text-align:center;">No upcoming matches</div>`;
    return;
  }

  // Extract tiers
  const now = list[0];
  const deck = list[1];
  const hole = list[2];
  const queue = list.slice(3);

  // Now Wrestling
  if (now) {
    el.innerHTML += `
      <div class="group-title">Now Wrestling</div>
      ${block(now, "now")}
      <div class="divider"></div>
    `;
  }

  // On Deck
  if (deck) {
    el.innerHTML += `
      <div class="group-title">On Deck</div>
      ${block(deck, "deck")}
      <div class="divider"></div>
    `;
  }

  // In the Hole
  if (hole) {
    el.innerHTML += `
      <div class="group-title">In The Hole</div>
      ${block(hole, "hole")}
      <div class="divider"></div>
    `;
  }

  // Remaining Queue
  if (queue.length) {
    el.innerHTML += `<div class="group-title">Queue</div>`;
    queue.forEach(m => {
      el.innerHTML += block(m, "");
    });
  }
}

/* ------------------ MATCH BLOCK UI ------------------ */

function block(m, cls) {
  return `
    <div class="match-block ${cls}">
      <div class="match-title">Bout ${m.bout} ${m.weight ? `— ${m.weight}` : ""}</div>
      <div class="match-line">${m.red?.name || ""} (${m.red?.team || ""})</div>
      <div class="match-line">vs</div>
      <div class="match-line">${m.green?.name || ""} (${m.green?.team || ""})</div>
    </div>
  `;
}

</script>

</body>
</html>
