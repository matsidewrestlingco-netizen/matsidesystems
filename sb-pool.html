<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SB Pool | SAWA</title>

  <style>
    /* ---------- SAWA-ish palette (red/blue) + lighter UI ---------- */
    :root{
      --bg1:#f6f8fc;
      --bg2:#eef3fb;

      --card:#ffffff;
      --stroke:rgba(15, 23, 42, 0.10);

      --text:#0f172a;     /* slate-900 */
      --muted:#475569;    /* slate-600 */

      --blue:#1b3a6b;     /* deep SA-ish blue */
      --red:#c81f2d;      /* SA-ish red */

      --good:#16a34a;     /* paid */
      --warn:#f59e0b;     /* pending */
      --bad:#dc2626;

      --shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      --radius: 18px;
    }

    /* Fix “inputs hanging off the card” */
    *, *::before, *::after { box-sizing: border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 450px at 15% 0%, rgba(27,58,107,0.08), transparent 55%),
        radial-gradient(900px 450px at 85% 0%, rgba(200,31,45,0.08), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    .wrap{ max-width:1100px; margin:0 auto; padding:20px; }

    /* Top header */
    .topbar{
      display:flex;
      align-items:center;
      gap:16px;
      padding:14px 16px;
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: linear-gradient(90deg, rgba(27,58,107,0.06), rgba(200,31,45,0.05));
      box-shadow: var(--shadow);
      margin-bottom: 14px;
    }
    .topbar img{ height:46px; width:auto; display:block; }
    .topbar h1{ font-size:24px; margin:0; line-height:1.1; }
    .topbar .sub{ margin:4px 0 0; color:var(--muted); font-size:13px; }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){ .grid{ grid-template-columns:1fr; } }

    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
    }

    h2{ margin:0 0 10px; font-size:18px; }
    p{ margin: 8px 0; color:var(--muted); line-height:1.45; }

    .pillbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--stroke);
      color:var(--muted);
      font-weight:900; font-size:12px;
      background:#fff;
    }
    .dot{ width:10px; height:10px; border-radius:999px; display:inline-block; background: rgba(15,23,42,0.35); }
    .dot.blue{ background: rgba(27,58,107,0.70); }
    .dot.red{ background: rgba(200,31,45,0.70); }
    .dot.avail{ background: rgba(27,58,107,0.65); }
    .dot.pending{ background: rgba(245,158,11,0.85); }
    .dot.paid{ background: rgba(22,163,74,0.85); }

    .hr{ height:1px; background: rgba(15,23,42,0.10); margin:14px 0; }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:12px 0 6px;
      font-weight:800;
    }
    input, select, textarea{
      width:100%;
      max-width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid rgba(15, 23, 42, 0.14);
      background:#ffffff;
      color:var(--text);
      outline:none;
      font-size:15px;
    }
    textarea{ min-height:110px; resize:vertical; }

    input:focus, select:focus, textarea:focus{
      border-color: rgba(27,58,107,0.45);
      box-shadow: 0 0 0 4px rgba(27,58,107,0.12);
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 700px){ .row{ grid-template-columns:1fr; } }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(15, 23, 42, 0.14);
      background:#fff;
      color:var(--text);
      cursor:pointer;
      font-weight:900;
      white-space:nowrap;
      text-decoration:none;
      width:100%;
    }
    .btn:hover{ background: rgba(15, 23, 42, 0.03); }

    .btn-blue{
      border-color: rgba(27,58,107,0.28);
      background: linear-gradient(180deg, rgba(27,58,107,0.10), rgba(27,58,107,0.06));
    }
    .btn-red{
      border-color: rgba(200,31,45,0.28);
      background: linear-gradient(180deg, rgba(200,31,45,0.10), rgba(200,31,45,0.06));
    }
    .btn-primary{
      border-color: rgba(27,58,107,0.35);
      background: linear-gradient(180deg, rgba(27,58,107,0.14), rgba(27,58,107,0.08));
      font-size:16px;
      padding:14px 14px;
    }

    .qrgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:10px;
    }
    .qrbox{
      border:1px solid var(--stroke);
      border-radius:16px;
      padding:10px;
      background:#fff;
      text-align:center;
    }
    .qrbox img{
      width:100%;
      height:auto;
      border-radius:12px;
      display:block;
      border:1px solid rgba(15,23,42,0.10);
    }
    .qrlabel{
      font-weight:900;
      margin-top:8px;
      color:var(--muted);
      font-size:12px;
      letter-spacing:0.2px;
      text-transform:uppercase;
    }

    .notice{
      border:1px solid rgba(27,58,107,0.18);
      background: rgba(27,58,107,0.06);
      border-radius:16px;
      padding:12px;
      color:var(--text);
    }

    .progressWrap{
      margin-top:10px;
      border:1px solid var(--stroke);
      border-radius:999px;
      overflow:hidden;
      background:#fff;
      height:12px;
    }
    .progressBar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(27,58,107,0.9), rgba(200,31,45,0.9));
    }

    .big{ font-size:14px; color:var(--text); font-weight:900; }
    .ok{ color:var(--good); font-weight:900; }
    .err{ color:var(--bad); font-weight:900; }
    .muted{ color:var(--muted); }

    /* ---------- 10x10 board grid ---------- */
    .boardWrap{
      border:1px solid var(--stroke);
      border-radius:16px;
      background:#fff;
      padding:10px;
      overflow:hidden;
    }

    .boardHeader{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }

    .boardGrid{
      display:grid;
      grid-template-columns: repeat(10, 1fr);
      gap:6px;
    }

    /* keeps the squares square and readable on mobile */
    .cell{
      aspect-ratio: 1 / 1;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:10px;
      border:1px solid rgba(15,23,42,0.10);
      font-weight:900;
      font-size: clamp(10px, 2.5vw, 14px);
      user-select:none;
    }

    .cell.available{
      background: rgba(27,58,107,0.08);
      border-color: rgba(27,58,107,0.18);
      color: var(--blue);
    }

    .cell.pending{
      background: rgba(245,158,11,0.14);
      border-color: rgba(245,158,11,0.22);
      color: #7a4b00;
    }

    .cell.paid{
      background: rgba(22,163,74,0.14);
      border-color: rgba(22,163,74,0.22);
      color: #0b5a25;
    }

    .cell.legend{
      background: rgba(15,23,42,0.03);
      color: var(--muted);
      font-weight:800;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- Top header (swap src to your hosted logo path) -->
    <div class="topbar">
      <img src="/assets/sawa.png" alt="SA Wrestling" />
      <div>
        <h1>2026 Super Bowl 50/50 Block Pool</h1>
        <div class="sub">
          Sponsored by <b>Shaler Area HS &amp; MS Wrestling Association (SAWA)</b> • Proceeds benefit Shaler Area JH and Varsity Boys &amp; Girls Wrestling Teams
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: payment + request form -->
      <div class="card">
        <h2>Pay + Request Blocks</h2>

        <div class="pillbar">
          <span class="pill"><span class="dot blue"></span>$30 / block</span>
          <span class="pill"><span class="dot red"></span>4 payouts • $1,500 total</span>
          <span class="pill"><span class="dot paid"></span>Blocks assigned after payment</span>
        </div>

        <div class="hr"></div>

        <div class="row">
          <a class="btn btn-blue" id="venmoBtn" href="#" target="_blank" rel="noopener">Pay via Venmo: @SAWATitans</a>
          <a class="btn btn-red" id="paypalBtn" href="#" target="_blank" rel="noopener">Pay via PayPal: @SAWATitans</a>
        </div>

        <p class="notice" style="margin-top:12px;">
          <span class="big">Important:</span> Put <b>SB Pool</b> in the memo line so we can match your payment.
        </p>

        <div class="qrgrid">
          <div class="qrbox">
            <img src="/assets/venmo_sawa.jpg" alt="Venmo QR" />
            <div class="qrlabel">Venmo QR</div>
          </div>
          <div class="qrbox">
            <img src="/assets/paypal_sawa.jpg" alt="PayPal QR" />
            <div class="qrlabel">PayPal QR</div>
          </div>
        </div>

        <div class="hr"></div>

        <form id="reqForm">
          <label>Your name</label>
          <input id="name" placeholder="First + Last" autocomplete="name" required />

          <label>Contact (email or phone)</label>
          <input id="contact" placeholder="So we can confirm your squares" autocomplete="email" required />

          <div class="row">
            <div>
              <label>How many blocks?</label>
              <select id="blocks" required>
                <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
                <option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option>
                <option value="9">9</option><option value="10">10</option>
              </select>
            </div>
            <div>
              <label>Preferred square numbers (optional)</label>
              <input id="preferred" placeholder="Example: 3, 18, 44" />
            </div>
          </div>

          <label>Notes (optional)</label>
          <textarea id="notes" placeholder="Anything we should know?"></textarea>

          <button class="btn btn-primary" type="submit" style="margin-top:12px;">Submit Request</button>

          <div id="msg" style="margin-top:10px;"></div>
        </form>
      </div>

      <!-- RIGHT: pool info + board -->
      <div class="card">
        <h2>Payouts + Rules</h2>

        <p class="big">Payouts (total $1,500)</p>
        <p>
          • 1st Qtr = <b>$150</b><br/>
          • Halftime = <b>$300</b><br/>
          • 3rd Qtr = <b>$150</b><br/>
          • Final Score = <b>$900</b>
        </p>

        <div class="hr"></div>

        <p class="big">How it works</p>
        <p>
          • <b>One set of numbers will be drawn</b>.<br/>
          • Axis numbers will be randomly drawn <b>once all blocks are sold</b>.<br/>
          • Blocks are <b>not assigned until payment has been received</b>.<br/>
          • Unsold blocks remain the property of <b>Shaler Area Wrestling Association</b>.
        </p>

        <div class="hr"></div>

        <p class="big">Availability</p>
        <p class="muted" id="availText">Loading availability…</p>
        <div class="progressWrap" aria-hidden="true">
          <div class="progressBar" id="availBar"></div>
        </div>

        <div class="hr"></div>

        <p class="big">Current Board (1–100)</p>
        <div class="pillbar" style="margin-bottom:10px;">
          <span class="pill"><span class="dot avail"></span>Available</span>
          <span class="pill"><span class="dot pending"></span>Pending</span>
          <span class="pill"><span class="dot paid"></span>Paid</span>
          <span class="pill" id="boardMeta" style="margin-left:auto;">Loading…</span>
        </div>

        <div class="boardWrap">
          <div class="boardGrid" id="boardGrid">
            <!-- populated by JS -->
          </div>
        </div>

        <div class="hr"></div>

        <p class="big">Why support us?</p>
        <p>
          Given Shaler’s long and storied legacy of outstanding wrestling over many generations, please consider supporting our wrestlers by purchasing a block or two.
          With fundraising such as this, we support healthy meals for match days, quality warmups and gear for Titan Pride, senior gifts, and unique upgrades like our
          newly installed <b>Titan competition spotlight</b> in HS Gym A.
        </p>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    // ✅ Replace these with your real project values
    const SUPABASE_URL = "https://polfteqwekkhzlhfjhsn.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBvbGZ0ZXF3ZWtraHpsaGZqaHNuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxMTU2MzAsImV4cCI6MjA4MDY5MTYzMH0.npJCJJKOLTQddFH-xtU_ZtlT9_M8JWWpScDIsZAGY4M";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Optional: payment button links (edit if you have better ones)
    document.getElementById("venmoBtn").href = "https://venmo.com/SAWATitans";
    document.getElementById("paypalBtn").href = "https://paypal.me/SAWATitans";

    const form = document.getElementById("reqForm");
    const msg = document.getElementById("msg");

    const availText = document.getElementById("availText");
    const availBar = document.getElementById("availBar");

    const boardGrid = document.getElementById("boardGrid");
    const boardMeta = document.getElementById("boardMeta");

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function setMessage(type, text) {
      if (!msg) return;
      const cls = type === "ok" ? "ok" : (type === "err" ? "err" : "muted");
      msg.innerHTML = `<div class="${cls}">${escapeHtml(text)}</div>`;
    }

    function statusOfSquare(row) {
      // row has: square, assigned_to_request, paid
      if (row?.paid) return "paid";
      if (row?.assigned_to_request) return "pending";
      return "available";
    }

    function renderBoard(rows) {
      // normalize to a map 1..100 in case rows are missing
      const map = new Map();
      for (const r of rows || []) map.set(r.square, r);

      const cells = [];
      for (let n = 1; n <= 100; n++) {
        const r = map.get(n) || { square: n, assigned_to_request: null, paid: false };
        const st = statusOfSquare(r);
        cells.push(`<div class="cell ${st}" title="Square ${n}">${n}</div>`);
      }
      boardGrid.innerHTML = cells.join("");
    }

    async function loadSquaresAndAvailability() {
      // Requires public SELECT policy on sb_pool_squares
      try {
        const { data, error } = await supabase
          .from("sb_pool_squares")
          .select("square,assigned_to_request,paid")
          .order("square", { ascending: true });

        if (error || !data) throw error;

        const total = data.length || 100;
        const available = data.filter(r => !r.assigned_to_request).length;
        const pending = data.filter(r => !!r.assigned_to_request && !r.paid).length;
        const paid = data.filter(r => r.paid).length;

        // availability bar
        availText.textContent = `${available} of ${total} squares still available.`;
        const sold = total - available;
        const pct = total > 0 ? Math.min(100, Math.max(0, (sold / total) * 100)) : 0;
        availBar.style.width = pct.toFixed(1) + "%";

        // board
        boardMeta.textContent = `Avail ${available} • Pending ${pending} • Paid ${paid}`;
        renderBoard(data);
      } catch (e) {
        console.error(e);
        availText.textContent = "Availability currently unavailable.";
        availBar.style.width = "0%";
        boardMeta.textContent = "Board unavailable";
        // still render blank board so layout stays consistent
        renderBoard([]);
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      setMessage("muted", "Submitting…");

      const name = document.getElementById("name").value.trim();
      const contact = document.getElementById("contact").value.trim();
      const blocks_requested = parseInt(document.getElementById("blocks").value, 10);
      const preferred_squares = document.getElementById("preferred").value.trim();
      const notes = document.getElementById("notes").value.trim();

      if (!name || !contact || !Number.isFinite(blocks_requested) || blocks_requested <= 0) {
        setMessage("err", "Please fill in your name, contact, and number of blocks.");
        return;
      }

      const payload = {
        name,
        contact,
        blocks_requested,
        preferred_squares: preferred_squares || null,
        notes: notes || null,
        status: "requested"
      };

      const { error } = await supabase.from("sb_pool_requests").insert([payload]);

      if (error) {
        console.error(error);
        setMessage("err", "Could not submit request. Please try again, or contact SAWA.");
        return;
      }

      setMessage("ok", "Request received! Once we match your payment, we’ll assign your squares and confirm.");
      form.reset();
      await loadSquaresAndAvailability();
    });

    loadSquaresAndAvailability();
    setInterval(loadSquaresAndAvailability, 30000);
  </script>
</body>
</html>
