<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Matside Scoreboard</title>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: #000;
    color: #fff;
    text-align: center;
  }
  #container {
    max-width: 760px;
    margin: 0 auto;
    padding: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  .label {
    font-size: 16px;
    font-weight: bold;
    padding: 6px 0;
  }
  #timer {
    font-size: 68px;
    font-weight: 800;
    padding: 12px 0;
  }
  .name {
    font-size: 28px;
    font-weight: bold;
    padding: 6px 0;
  }
  .score-box {
    font-size: 120px;
    font-weight: 800;
    padding: 16px 0;
  }
  .red { background: #c62828; }
  .green { background: #2e7d32; }
</style>
</head>

<body>
<div id="container">
  <table>
    <tbody>
      <tr>
        <td class="label">MAT</td>
        <td class="label" colspan="2">MATSIDE SCOREBOARD</td>
        <td class="label">PERIOD</td>
      </tr>

      <tr>
        <td id="mat-number" style="font-size:32px;font-weight:800;">1</td>
        <td></td>
        <td></td>
        <td id="period-number" style="font-size:32px;font-weight:800;">1</td>
      </tr>

      <tr>
        <td class="label" colspan="4">TIME</td>
      </tr>
      <tr>
        <td id="timer" colspan="4">00:00</td>
      </tr>

      <tr>
        <td id="red-name" class="name" colspan="2" style="color:#ff4444;">RED WRESTLER</td>
        <td id="green-name" class="name" colspan="2" style="color:#66ff66;">GREEN WRESTLER</td>
      </tr>

      <tr>
        <td class="score-box red" colspan="2"><span id="sb-red">0</span></td>
        <td class="score-box green" colspan="2"><span id="sb-green">0</span></td>
      </tr>
    </tbody>
  </table>
</div>

<script>
/* --- WHY: get ?mat= from URL so each embed shows only its own mat --- */
function getMatFromURL() {
  const p = new URLSearchParams(window.location.search);
  const m = Number(p.get("mat"));
  return Number.isFinite(m) && m >= 1 ? m : 1;
}

const mat = getMatFromURL();
document.getElementById("mat-number").textContent = mat;

/* Connect to Render server */
const SERVER = "https://scoreboard-server-er33.onrender.com";
const socket = io(SERVER, { transports:["websocket"] });

/* Format mm:ss */
function fmt(sec) {
  sec = Math.max(0, Number(sec) || 0);
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
}

/* Update scoreboard when server pushes state */
socket.on("stateUpdate", state => {
  const m = state?.mats?.[mat];
  if (!m) return;

  document.getElementById("period-number").textContent = m.period;
  document.getElementById("timer").textContent = fmt(m.timeRemaining);
  document.getElementById("sb-red").textContent = m.player1;
  document.getElementById("sb-green").textContent = m.player2;
  document.getElementById("red-name").textContent = m.redName || "RED WRESTLER";
  document.getElementById("green-name").textContent = m.greenName || "GREEN WRESTLER";
});
</script>
</body>
</html>
